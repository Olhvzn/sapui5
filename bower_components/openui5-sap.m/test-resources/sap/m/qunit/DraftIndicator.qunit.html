<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta charset="utf-8">
	<title>Test Page for sap.m.DraftIndicator</title>
<link rel="stylesheet" href="../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen">

		<!-- UI5 Bootstrap -->
		<script src="../shared-config.js"></script>
		<script id="sap-ui-bootstrap"
			src="../../../../resources/sap-ui-core.js"
			data-sap-ui-noConflict="true"
			data-sap-ui-libs="sap.m">
		</script>

		<!-- QUnit libraries -->
		<script src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script src="../../../../resources/sap/ui/thirdparty/sinon.js"></script>
		<script src="../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>


	<!-- use the sinon faketimers for this test -->
	<script>
		sinon.config.useFakeTimers = true;
	</script>

	<script>

	var oBundle = sap.ui.getCore().getLibraryResourceBundle("sap.m");
	var oCore = sap.ui.getCore();

	QUnit.module("id");

	QUnit.test("semantic control can be retrieved by Id", function (assert) {
		// Arrange
		var oDraftIndi = new sap.m.DraftIndicator("draftId");

		assert.strictEqual(oDraftIndi.getId(), "draftId", "control has the expected id");

		// Act
		var oRetrievedIndi = sap.ui.getCore().byId("draftId");

		// Assert
		assert.notEqual(oRetrievedIndi, undefined, "the button is retrieved by id");
		assert.strictEqual(oRetrievedIndi.getId(), "draftId", "control has the expected id");

		oDraftIndi.destroy();
	});


	QUnit.module("states");

	QUnit.test("set 'Saving draft' and 'Clear Draft' state", function (assert) {
		// Arrange
		var oDraftIndi = new sap.m.DraftIndicator();

		// System under test
		oDraftIndi.placeAt("qunit-fixture-visible");
		oCore.applyChanges();

		// Act
		oDraftIndi.showDraftSaving();
		// Assert
		assert.strictEqual(oDraftIndi._getLabel().getText(), oBundle.getText("DRAFT_INDICATOR_SAVING_DRAFT"), "Saving draft is shown");

		this.clock.tick(3000);

		// Act
		oDraftIndi.clearDraftState();
		// Assert
		assert.strictEqual(oDraftIndi._getLabel().getText(), "", "Draft saved is cleared");

		// Clean up
		oDraftIndi.destroy();
	});

	QUnit.test("set Draft Saved state and check that it is not cleared after default timeout", function (assert) {
		// Arrange
		var oDraftIndi = new sap.m.DraftIndicator();

		// System under test
		oDraftIndi.placeAt("qunit-fixture-visible");
		oCore.applyChanges();

		// Act
		oDraftIndi.showDraftSaved();

		// Assert
		assert.strictEqual(oDraftIndi.$("label").text(), oBundle.getText("DRAFT_INDICATOR_DRAFT_SAVED"), "Draft saved is shown");
		this.clock.tick(1500);

		// Assert
		assert.ok(oDraftIndi.$("label").text()!="", "Draft saved state is not cleared after default timeout");

		// Clean up
		oDraftIndi.destroy();
	});

	QUnit.test("set Draft Saving state and check that if it is cleared after default timeout", function (assert) {
		// Arrange
		var oDraftIndi = new sap.m.DraftIndicator();

		// System under test
		oDraftIndi.placeAt("qunit-fixture-visible");
		oCore.applyChanges();

		// Act
		oDraftIndi.showDraftSaving();

		// Assert
		assert.strictEqual(oDraftIndi.$("label").text(), oBundle.getText("DRAFT_INDICATOR_SAVING_DRAFT"), "Draft saved is shown");
		this.clock.tick(1500);

		// Assert
		assert.strictEqual(oDraftIndi.$("label").text(), "", "Draft saving state is cleared after default timeout");

		// Clean up
		oDraftIndi.destroy();
	});

	QUnit.test("the control doesn't recreate the label upon destruction", function (assert) {
		// Arrange
		var oDraftIndi = new sap.m.DraftIndicator();

		// Act
		oDraftIndi.showDraftSaving();
		oDraftIndi.destroy();
		this.clock.tick(1500);

		// Assert
		assert.strictEqual(oDraftIndi.getAggregation("_label"), null, "The label was not recreated");

		// Clean up
		oDraftIndi.destroy();
	});


	</script>
</head>
<body id="body" class="sapUiBody">
<h1 id="qunit-header">QUnit tests: sap.m.DraftIndicator</h1>

<h2 id="qunit-banner"></h2>

<h2 id="qunit-userAgent"></h2>
<!--<div id="qunit-testrunner-toolbar"></div>-->
<ol id="qunit-tests"></ol>
<div id="qunit-fixture"></div>
<div id="qunit-fixture-visible"></div>
</body>
</html>